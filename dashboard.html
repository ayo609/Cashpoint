<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Cashpoint | Dashboard</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

<!-- SweetAlert2 -->
<script src="cashpoint-modal.js"></script>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Sora:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root {
    --primary:       #0052FF;
    --primary-light: #3b7dff;
    --primary-dark:  #0039b3;
    --accent:        #00D4A0;
    --accent-dark:   #00a87e;
    --warning:       #FFB800;
    --danger:        #FF4D6D;
    --success:       #00C48C;
    --bg:            #F0F4FF;
    --card:          #ffffff;
    --text:          #0D1B3E;
    --muted:         #6B7A99;
    --border:        #D8E0F0;
    --nav-h:         70px;
    --bottom-h:      72px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }
  html { scroll-behavior: smooth; }

  body {
    font-family: 'Plus Jakarta Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    padding-bottom: calc(var(--bottom-h) + 20px);
    overflow-x: hidden;
    min-height: 100vh;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOP BAR
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .topbar {
    position: sticky;
    top: 0;
    z-index: 900;
    height: var(--nav-h);
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    gap: 12px;
  }
  .topbar-left {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .topbar-logo {
    width: 38px;
    height: 38px;
    background: var(--primary);
    border-radius: 11px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    flex-shrink: 0;
  }
  .topbar-brand {
    font-family: 'Sora', sans-serif;
    font-size: 20px;
    font-weight: 700;
    color: var(--text);
    letter-spacing: -0.3px;
  }
  .topbar-right {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .topbar-clock {
    font-size: 12.5px;
    color: var(--muted);
    font-weight: 600;
    display: none;
  }
  @media (min-width: 520px) { .topbar-clock { display: block; } }

  .notif-btn {
    position: relative;
    width: 38px;
    height: 38px;
    border-radius: 11px;
    background: var(--bg);
    border: 1.5px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 17px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .notif-btn:hover { background: #dde6ff; }
  .notif-dot {
    position: absolute;
    top: 6px;
    right: 6px;
    width: 8px;
    height: 8px;
    background: var(--danger);
    border-radius: 50%;
    border: 2px solid white;
  }
  .user-avatar {
    width: 38px;
    height: 38px;
    border-radius: 11px;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 800;
    font-size: 15px;
    flex-shrink: 0;
    cursor: pointer;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HERO BANNER
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .hero {
    background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 55%, #001c6b 100%);
    padding: 30px 22px 96px;
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute;
    width: 380px;
    height: 380px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.05);
    top: -110px;
    right: -90px;
  }
  .hero::after {
    content: '';
    position: absolute;
    width: 220px;
    height: 220px;
    border-radius: 50%;
    background: rgba(0, 212, 160, 0.1);
    bottom: -70px;
    left: -50px;
  }
  .hero-tag {
    font-size: 11.5px;
    font-weight: 700;
    color: rgba(255, 255, 255, 0.6);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 6px;
  }
  .hero-greeting {
    font-family: 'Sora', sans-serif;
    font-size: clamp(22px, 5.5vw, 30px);
    font-weight: 700;
    color: #fff;
    margin-bottom: 6px;
    position: relative;
    z-index: 1;
  }
  .hero-sub-row {
    display: flex;
    align-items: center;
    gap: 7px;
    font-size: 13px;
    color: rgba(255, 255, 255, 0.65);
    font-weight: 500;
    position: relative;
    z-index: 1;
  }
  .live-dot {
    width: 7px;
    height: 7px;
    background: var(--accent);
    border-radius: 50%;
    flex-shrink: 0;
    animation: livePulse 2s ease-in-out infinite;
  }
  @keyframes livePulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50%       { transform: scale(1.5); opacity: 0.55; }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FLOATING BALANCE CARD
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .balance-outer {
    padding: 0 16px;
    margin-top: -58px;
    position: relative;
    z-index: 10;
  }
  .balance-card {
    background: white;
    border-radius: 22px;
    box-shadow: 0 14px 44px rgba(0, 82, 255, 0.15);
    padding: 22px 22px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 14px;
    flex-wrap: wrap;
    animation: riseUp 0.55s cubic-bezier(0.16, 1, 0.3, 1) both;
  }
  @keyframes riseUp {
    from { opacity: 0; transform: translateY(24px); }
    to   { opacity: 1; transform: translateY(0); }
  }
  .bal-info { flex: 1; min-width: 130px; }
  .bal-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin-bottom: 4px;
  }
  .bal-figure {
    font-family: 'Sora', sans-serif;
    font-size: clamp(26px, 7vw, 36px);
    font-weight: 700;
    color: var(--text);
    letter-spacing: -1.5px;
    line-height: 1;
  }
  .bal-figure .sym {
    font-size: 16px;
    color: var(--muted);
    font-weight: 600;
    letter-spacing: 0;
  }
  .bal-pill {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: #E8FFF6;
    color: var(--success);
    border-radius: 99px;
    padding: 4px 11px;
    font-size: 11.5px;
    font-weight: 700;
    margin-top: 8px;
  }
  .bal-actions {
    display: flex;
    gap: 12px;
  }
  .bal-act {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    text-decoration: none;
    cursor: pointer;
  }
  .bal-act-icon {
    width: 46px;
    height: 46px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    transition: transform 0.2s;
  }
  .bal-act:hover .bal-act-icon { transform: translateY(-3px); }
  .bal-act-icon.dep  { background: #E8F0FF; color: var(--primary); }
  .bal-act-icon.with { background: #FFF0F3; color: var(--danger); }
  .bal-act-icon.inv  { background: #E8FFF6; color: var(--success); }
  .bal-act span {
    font-size: 10.5px;
    font-weight: 700;
    color: var(--muted);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STATS ROW
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 20px 16px 0;
  }
  @media (min-width: 480px) {
    .stats-row { grid-template-columns: repeat(4, 1fr); }
  }
  .stat-tile {
    background: white;
    border-radius: 16px;
    padding: 16px 14px;
    text-align: center;
    box-shadow: 0 4px 16px rgba(0, 82, 255, 0.07);
    animation: riseUp 0.55s cubic-bezier(0.16, 1, 0.3, 1) both;
  }
  .stat-tile:nth-child(2) { animation-delay: 0.07s; }
  .stat-tile:nth-child(3) { animation-delay: 0.14s; }
  .stat-tile:nth-child(4) { animation-delay: 0.21s; }
  .stat-tile-icon { font-size: 22px; margin-bottom: 8px; }
  .stat-tile-val {
    font-family: 'Sora', sans-serif;
    font-size: 17px;
    font-weight: 700;
    color: var(--text);
  }
  .stat-tile-lbl {
    font-size: 10.5px;
    color: var(--muted);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 3px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION HELPERS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .section {
    padding: 26px 16px 0;
  }
  .section-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
  }
  .section-title {
    font-family: 'Sora', sans-serif;
    font-size: 17px;
    font-weight: 700;
    color: var(--text);
  }
  .section-more {
    font-size: 13px;
    font-weight: 700;
    color: var(--primary);
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .section-more:hover { text-decoration: underline; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     QUICK ACTION TILES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .actions-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
  }
  @media (max-width: 380px) {
    .actions-row { grid-template-columns: repeat(2, 1fr); }
  }
  .action-tile {
    background: white;
    border-radius: 16px;
    padding: 16px 10px;
    text-align: center;
    text-decoration: none;
    box-shadow: 0 4px 14px rgba(0, 82, 255, 0.07);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
  }
  .action-tile:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 28px rgba(0, 82, 255, 0.14);
  }
  .act-icon {
    width: 46px;
    height: 46px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
  }
  .act-icon.c1 { background: #E8F0FF; }
  .act-icon.c2 { background: #FFF0F3; }
  .act-icon.c3 { background: #E8FFF6; }
  .act-icon.c4 { background: #FFF8E8; }
  .act-icon.c5 { background: #F3E8FF; }
  .act-icon.c6 { background: #E8F9FF; }
  .action-tile span {
    font-size: 11.5px;
    font-weight: 700;
    color: var(--text);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     INVESTMENT CARDS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .inv-stack {
    display: flex;
    flex-direction: column;
    gap: 14px;
  }
  .inv-card {
    background: white;
    border-radius: 20px;
    padding: 20px;
    box-shadow: 0 4px 20px rgba(0, 82, 255, 0.08);
    animation: riseUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) both;
    transition: box-shadow 0.2s;
  }
  .inv-card:hover { box-shadow: 0 10px 32px rgba(0, 82, 255, 0.14); }

  /* Card top row */
  .inv-top {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 10px;
    margin-bottom: 16px;
  }
  .inv-plan-name {
    font-family: 'Sora', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 5px;
  }
  .inv-badge {
    display: inline-block;
    padding: 3px 11px;
    border-radius: 99px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }
  .b-starter { background: #E8F0FF; color: var(--primary); }
  .b-growth  { background: #E8FFF6; color: var(--success); }
  .b-premium { background: #FFF8E8; color: var(--warning); }
  .b-elite   { background: #FFF0F3; color: var(--danger); }
  .b-default { background: var(--bg); color: var(--muted); }

  .inv-active-tag {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: #E8FFF6;
    color: var(--success);
    border-radius: 99px;
    padding: 5px 12px;
    font-size: 11px;
    font-weight: 700;
    flex-shrink: 0;
  }
  .inv-active-tag .pulse-dot {
    width: 6px;
    height: 6px;
    background: var(--success);
    border-radius: 50%;
    animation: livePulse 1.6s ease-in-out infinite;
  }

  /* Details grid */
  .inv-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    margin-bottom: 16px;
  }
  .inv-det {
    background: var(--bg);
    border-radius: 11px;
    padding: 10px 12px;
  }
  .inv-det .d-label {
    font-size: 10px;
    font-weight: 700;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 3px;
  }
  .inv-det .d-val {
    font-size: 14px;
    font-weight: 700;
    color: var(--text);
  }
  .inv-det .d-val.green { color: var(--success); }

  /* Progress bar */
  .prog-wrap { margin-bottom: 14px; }
  .prog-meta {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--muted);
    font-weight: 600;
    margin-bottom: 7px;
  }
  .prog-track {
    background: var(--border);
    border-radius: 99px;
    height: 8px;
    overflow: hidden;
  }
  .prog-fill {
    height: 100%;
    border-radius: 99px;
    background: linear-gradient(90deg, var(--primary), var(--accent));
    transition: width 0.7s ease;
  }

  /* Countdown */
  .countdown-box {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    background: var(--bg);
    border-radius: 12px;
    padding: 13px 15px;
    margin-bottom: 12px;
  }
  .cd-label {
    font-size: 12px;
    font-weight: 700;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .cd-timer {
    font-family: 'Sora', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: var(--primary);
    letter-spacing: 1.5px;
  }
  .cd-timer.ready {
    color: var(--success);
    letter-spacing: 0;
  }

  /* Earned row */
  .inv-earned-row {
    text-align: center;
    font-size: 13.5px;
    font-weight: 700;
    color: var(--success);
    background: #E8FFF6;
    border-radius: 10px;
    padding: 9px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     REFERRAL BANNER CARD
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .ref-card {
    background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
    border-radius: 20px;
    padding: 22px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    box-shadow: 0 8px 28px rgba(0, 212, 160, 0.28);
    cursor: pointer;
    transition: transform 0.2s;
  }
  .ref-card:hover { transform: translateY(-3px); }
  .ref-card-left {}
  .ref-card-title {
    font-family: 'Sora', sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: #fff;
    margin-bottom: 4px;
  }
  .ref-card-sub {
    font-size: 12.5px;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 500;
    margin-bottom: 14px;
    line-height: 1.5;
  }
  .ref-link-row {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.2);
    border: 1.5px solid rgba(255, 255, 255, 0.35);
    border-radius: 10px;
    padding: 9px 12px;
  }
  .ref-link-txt {
    font-size: 12px;
    font-weight: 700;
    color: #fff;
    flex: 1;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 185px;
  }
  .ref-copy-btn {
    background: white;
    color: var(--accent-dark);
    border: none;
    border-radius: 7px;
    padding: 5px 11px;
    font-size: 12px;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    white-space: nowrap;
    transition: opacity 0.2s;
    flex-shrink: 0;
  }
  .ref-copy-btn:hover { opacity: 0.85; }
  .ref-stats-row {
    display: flex;
    gap: 16px;
    margin-top: 12px;
  }
  .ref-stat {
    font-size: 12.5px;
    color: rgba(255, 255, 255, 0.85);
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .ref-card-emoji {
    font-size: 52px;
    flex-shrink: 0;
    align-self: center;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EMPTY STATE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .empty-box {
    background: white;
    border-radius: 20px;
    padding: 48px 24px;
    text-align: center;
    box-shadow: 0 4px 18px rgba(0, 82, 255, 0.07);
  }
  .empty-emoji { font-size: 54px; margin-bottom: 14px; }
  .empty-heading {
    font-family: 'Sora', sans-serif;
    font-size: 18px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 8px;
  }
  .empty-body {
    font-size: 14px;
    color: var(--muted);
    line-height: 1.6;
    margin-bottom: 22px;
  }
  .empty-cta {
    display: inline-block;
    padding: 12px 30px;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 99px;
    font-size: 14px;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    text-decoration: none;
    box-shadow: 0 6px 20px rgba(0, 82, 255, 0.3);
    transition: transform 0.15s, box-shadow 0.15s;
  }
  .empty-cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 28px rgba(0, 82, 255, 0.38);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SIGN OUT BUTTON
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .signout-section {
    padding: 22px 16px 0;
  }
  .signout-btn {
    width: 100%;
    padding: 15px;
    background: white;
    color: var(--danger);
    border: 1.5px solid #ffd0d8;
    border-radius: 16px;
    font-size: 15px;
    font-weight: 700;
    font-family: inherit;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 9px;
    transition: background 0.2s, transform 0.15s;
  }
  .signout-btn:hover {
    background: #FFF0F3;
    transform: translateY(-1px);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BOTTOM NAVIGATION
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: var(--bottom-h);
    background: white;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-around;
    padding: 0 8px;
    z-index: 999;
    box-shadow: 0 -4px 24px rgba(0, 82, 255, 0.09);
  }
  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    text-decoration: none;
    padding: 8px 12px;
    border-radius: 14px;
    flex: 1;
    max-width: 74px;
    transition: background 0.2s;
    cursor: pointer;
  }
  .nav-item:hover { background: var(--bg); }
  .nav-item i {
    font-size: 20px;
    color: var(--muted);
    transition: color 0.2s, transform 0.2s;
  }
  .nav-item span {
    font-size: 10.5px;
    font-weight: 700;
    color: var(--muted);
    transition: color 0.2s;
  }
  .nav-item.active i,
  .nav-item.active span { color: var(--primary); }
  .nav-item.active i    { transform: translateY(-2px); }

  .nav-center {
    width: 52px;
    height: 52px;
    border-radius: 16px;
    background: var(--primary);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 6px 22px rgba(0, 82, 255, 0.38);
    text-decoration: none;
    transition: transform 0.2s;
    margin-bottom: 10px;
    flex-shrink: 0;
  }
  .nav-center:hover { transform: translateY(-3px); }
  .nav-center i { color: white; font-size: 21px; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SHIMMER SKELETON
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .skeleton {
    background: linear-gradient(90deg, #e8edf5 25%, #f4f7fc 50%, #e8edf5 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 9px;
  }
  @keyframes shimmer {
    0%   { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  .page-bottom { height: 16px; }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â• TOP BAR â•â•â•â•â•â•â•â•â•â• -->
<div class="topbar">
  <div class="topbar-left">
    <div class="topbar-logo">ğŸ’°</div>
    <span class="topbar-brand">Dashboard</span>
  </div>
  <div class="topbar-right">
    <span class="topbar-clock" id="topClock">--:--</span>
    <div class="notif-btn" title="Notifications">
      ğŸ””
      <div class="notif-dot"></div>
    </div>
    <div class="user-avatar" id="avatarBox">?</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• HERO â•â•â•â•â•â•â•â•â•â• -->
<div class="hero">
  <div class="hero-tag">My Dashboard</div>
  <div class="hero-greeting" id="heroGreeting">Loading...</div>
  <div class="hero-sub-row">
    <div class="live-dot"></div>
    <span id="heroLastLogin">Fetching account data...</span>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• BALANCE CARD â•â•â•â•â•â•â•â•â•â• -->
<div class="balance-outer">
  <div class="balance-card">
    <div class="bal-info">
      <div class="bal-label">Available Balance</div>
      <div class="bal-figure">
        <span class="sym">â‚¦</span><span id="balanceValue">0.00</span>
      </div>
      <div class="bal-pill">
        <i class="fas fa-circle" style="font-size:7px;"></i>
        Account Active
      </div>
    </div>
    <div class="bal-actions">
      <a href="deposit.html" class="bal-act">
        <div class="bal-act-icon dep"><i class="fas fa-plus"></i></div>
        <span>Deposit</span>
      </a>
      <a href="withdrawal.html" class="bal-act">
        <div class="bal-act-icon with"><i class="fas fa-arrow-up"></i></div>
        <span>Withdraw</span>
      </a>
      <a href="plans.html" class="bal-act">
        <div class="bal-act-icon inv"><i class="fas fa-chart-line"></i></div>
        <span>Invest</span>
      </a>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• STATS ROW â•â•â•â•â•â•â•â•â•â• -->
<div class="stats-row">
  <div class="stat-tile">
    <div class="stat-tile-icon">ğŸ’°</div>
    <div class="stat-tile-val" id="statTotalInvested">â‚¦0</div>
    <div class="stat-tile-lbl">Invested</div>
  </div>
  <div class="stat-tile">
    <div class="stat-tile-icon">ğŸ“ˆ</div>
    <div class="stat-tile-val" id="statTotalEarnings">â‚¦0</div>
    <div class="stat-tile-lbl">Earnings</div>
  </div>
  <div class="stat-tile">
    <div class="stat-tile-icon">ğŸ”„</div>
    <div class="stat-tile-val" id="statActivePlans">0</div>
    <div class="stat-tile-lbl">Active Plans</div>
  </div>
  <div class="stat-tile">
    <div class="stat-tile-icon">ğŸ¤</div>
    <div class="stat-tile-val" id="statReferrals">0</div>
    <div class="stat-tile-lbl">Referrals</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• QUICK ACTIONS â•â•â•â•â•â•â•â•â•â• -->
<div class="section">
  <div class="section-head">
    <div class="section-title">Quick Actions</div>
  </div>
  <div class="actions-row">
    <a href="deposit.html" class="action-tile">
      <div class="act-icon c1">ğŸ’³</div>
      <span>Deposit</span>
    </a>
    <a href="withdrawal.html" class="action-tile">
      <div class="act-icon c2">ğŸ¦</div>
      <span>Withdraw</span>
    </a>
    <a href="plans.html" class="action-tile">
      <div class="act-icon c3">ğŸ“Š</div>
      <span>Invest</span>
    </a>
    <a href="referrals.html" class="action-tile">
      <div class="act-icon c4">ğŸ</div>
      <span>Referrals</span>
    </a>
    <a href="transactions.html" class="action-tile">
      <div class="act-icon c5">ğŸ“‹</div>
      <span>History</span>
    </a>
    <a href="profile.html" class="action-tile">
      <div class="act-icon c6">ğŸ‘¤</div>
      <span>Profile</span>
    </a>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• REFERRAL CARD â•â•â•â•â•â•â•â•â•â• -->
<div class="section">
  <div class="section-head">
    <div class="section-title">Referral Program</div>
    <a href="referrals.html" class="section-more">
      View all <i class="fas fa-chevron-right" style="font-size:11px;"></i>
    </a>
  </div>
  <div class="ref-card">
    <div class="ref-card-left">
      <div class="ref-card-title">Invite &amp; Earn Rewards</div>
      <div class="ref-card-sub">
        Share your link and earn a bonus<br>for every friend who joins and invests.
      </div>
      <div class="ref-link-row">
        <div class="ref-link-txt" id="refLinkDisplay">Generating link...</div>
        <button class="ref-copy-btn" id="refCopyBtn" onclick="copyReferralLink()">Copy</button>
      </div>
      <div class="ref-stats-row">
        <div class="ref-stat">
          <i class="fas fa-users" style="font-size:11px;"></i>
          <span id="refCountText">0 referrals</span>
        </div>
      </div>
    </div>
    <div class="ref-card-emoji">ğŸ</div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• ACTIVE INVESTMENTS â•â•â•â•â•â•â•â•â•â• -->
<div class="section">
  <div class="section-head">
    <div class="section-title">Active Investments</div>
    <a href="investments.html" class="section-more">
      See all <i class="fas fa-chevron-right" style="font-size:11px;"></i>
    </a>
  </div>
  <div class="inv-stack" id="investmentStack">
    <!-- Loading skeleton -->
    <div class="inv-card">
      <div class="skeleton" style="height:18px; width:55%; margin-bottom:14px;"></div>
      <div class="skeleton" style="height:12px; width:100%; margin-bottom:8px;"></div>
      <div class="skeleton" style="height:12px; width:75%; margin-bottom:8px;"></div>
      <div class="skeleton" style="height:8px; width:100%;"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• SIGN OUT â•â•â•â•â•â•â•â•â•â• -->
<div class="signout-section">
  <button class="signout-btn" onclick="confirmLogout()">
    <i class="fas fa-sign-out-alt"></i> Sign Out of Cashpoint
  </button>
</div>

<div class="page-bottom"></div>

<!-- â•â•â•â•â•â•â•â•â•â• BOTTOM NAV â•â•â•â•â•â•â•â•â•â• -->
<div class="bottom-nav">
  <a href="home.html" class="nav-item">
    <i class="fas fa-home"></i>
    <span>Home</span>
  </a>
  <a href="plans.html" class="nav-item">
    <i class="fas fa-chart-line"></i>
    <span>Plans</span>
  </a>
  <a href="investments.html" class="nav-center" title="My Investments">
    <i class="fas fa-wallet"></i>
  </a>
  <a href="referrals.html" class="nav-item">
    <i class="fas fa-users"></i>
    <span>Referrals</span>
  </a>
  <a href="dashboard.html" class="nav-item active">
    <i class="fas fa-user-circle"></i>
    <span>Profile</span>
  </a>
</div>

<!-- â•â•â•â•â•â•â•â•â•â• JAVASCRIPT â•â•â•â•â•â•â•â•â•â• -->
<script>

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FIREBASE INITIALISATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const firebaseConfig = {
  apiKey:            "AIzaSyCFwefJ8rxZUDLbDsRHnHdA-28zPs49rlo",
  authDomain:        "cashpoint-ac4f4.firebaseapp.com",
  projectId:         "cashpoint-ac4f4",
  storageBucket:     "cashpoint-ac4f4.firebasestorage.app",
  messagingSenderId: "16133206416",
  appId:             "1:16133206416:web:a093f4e153ad2c9bcc8315"
};

if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db   = firebase.firestore();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GLOBAL STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let currentUserId      = null;
let userReferralCode   = '';
let countdownTimers    = [];   // store interval IDs so we can clear on re-load
let dashboardRefresh   = null; // setInterval handle for auto-refresh

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIVE CLOCK (no localStorage)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function tickClock() {
  const now = new Date();
  document.getElementById('topClock').textContent =
    now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}
tickClock();
setInterval(tickClock, 1000);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MONEY FORMATTERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function formatFull(amount) {
  return Number(amount || 0).toLocaleString('en-NG', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2
  });
}

function formatShort(amount) {
  const v = Number(amount || 0);
  if (v >= 1_000_000) return 'â‚¦' + (v / 1_000_000).toFixed(2) + 'M';
  if (v >= 1_000)     return 'â‚¦' + (v / 1_000).toFixed(1) + 'K';
  return 'â‚¦' + v.toLocaleString('en-NG', { minimumFractionDigits: 0 });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BADGE CLASS FROM PLAN NAME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getPlanBadgeClass(planName) {
  const n = (planName || '').toLowerCase();
  if (n.includes('starter')) return 'b-starter';
  if (n.includes('growth'))  return 'b-growth';
  if (n.includes('premium')) return 'b-premium';
  if (n.includes('elite'))   return 'b-elite';
  return 'b-default';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TIME-OF-DAY GREETING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function timeGreeting() {
  const h = new Date().getHours();
  if (h < 12) return 'Good morning';
  if (h < 17) return 'Good afternoon';
  return 'Good evening';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH STATE â€” ENTRY POINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
auth.onAuthStateChanged(async (user) => {
  if (!user) {
    window.location.href = 'login.html';
    return;
  }
  currentUserId = user.uid;

  /* Claim any pending referral credits before loading dashboard */
  claimPendingReferralCredits(currentUserId); /* fire-and-forget */

  await loadDashboard();

  /* Auto-refresh every 60 seconds */
  if (dashboardRefresh) clearInterval(dashboardRefresh);
  dashboardRefresh = setInterval(loadDashboard, 60000);
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN DASHBOARD LOADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadDashboard() {
  try {

    /* â”€â”€ 1. Fetch user document â”€â”€ */
    const userSnap = await db.collection('users').doc(currentUserId).get();

    if (!userSnap.exists) {
      await auth.signOut();
      window.location.href = 'login.html';
      return;
    }

    const u = userSnap.data();

    /* â”€â”€ 2. Update hero section â”€â”€ */
    const firstName = (u.fullName || u.username || 'Investor').split(' ')[0];
    document.getElementById('heroGreeting').textContent =
      `${timeGreeting()}, ${firstName} ğŸ‘‹`;
    document.getElementById('avatarBox').textContent =
      firstName.charAt(0).toUpperCase();

    if (u.lastLogin) {
      const d = u.lastLogin.toDate();
      const displayDate = d.toLocaleDateString('en-NG', {
        weekday: 'short', month: 'short',
        day: 'numeric', hour: '2-digit', minute: '2-digit'
      });
      document.getElementById('heroLastLogin').textContent =
        'Last login: ' + displayDate;
    } else {
      document.getElementById('heroLastLogin').textContent =
        'Welcome to Cashpoint!';
    }

    /* â”€â”€ 3. Balance â”€â”€ */
    document.getElementById('balanceValue').textContent =
      formatFull(u.balance);

    /* â”€â”€ 4. Stats â”€â”€ */
    document.getElementById('statTotalInvested').textContent =
      formatShort(u.totalInvested);
    document.getElementById('statTotalEarnings').textContent =
      formatShort(u.totalEarnings);
    document.getElementById('statReferrals').textContent =
      u.referralCount || 0;

    /* â”€â”€ 5. Referral link â”€â”€ */
    userReferralCode =
      u.referralCode || u.username || currentUserId.slice(0, 8);
    const origin  = window.location.origin;
    const refLink = `${origin}/signup.html?ref=${userReferralCode}`;
    document.getElementById('refLinkDisplay').textContent = refLink;
    document.getElementById('refCountText').textContent =
      `${u.referralCount || 0} referral${(u.referralCount || 0) !== 1 ? 's' : ''}`;

    /* â”€â”€ 6. Fetch active investments â”€â”€ */
    const invSnap = await db.collection('investments')
      .where('userId', '==', currentUserId)
      .where('active',  '==', true)
      .get();

    document.getElementById('statActivePlans').textContent = invSnap.size;

    /* â”€â”€ 7. Clear old countdown timers before re-render â”€â”€ */
    countdownTimers.forEach(id => clearInterval(id));
    countdownTimers = [];

    const stack = document.getElementById('investmentStack');
    stack.innerHTML = '';

    /* â”€â”€ 8. Empty state â”€â”€ */
    if (invSnap.empty) {
      stack.innerHTML = `
        <div class="empty-box">
          <div class="empty-emoji">ğŸ“­</div>
          <div class="empty-heading">No Active Investments</div>
          <div class="empty-body">
            You don't have any active plans yet.<br>
            Browse our plans and start growing your money today!
          </div>
          <a href="plans.html" class="empty-cta">Browse Investment Plans</a>
        </div>`;
      return;
    }

    /* â”€â”€ 9. Build each investment card â”€â”€ */
    for (const doc of invSnap.docs) {
      const inv   = doc.data();
      const invId = doc.id;

      /* Auto-credit ROI if 24 h have elapsed */
      const lastROITime = inv.lastROI
        ? inv.lastROI.toDate()
        : (inv.activationTime ? inv.activationTime.toDate() : new Date());

      const hoursElapsed =
        (Date.now() - lastROITime.getTime()) / 3600000;

      if (hoursElapsed >= 24 && inv.active) {
        await creditROI(invId, inv.dailyROI || 0, inv);
        /* Re-fetch fresh balance after crediting */
        const freshUser = await db.collection('users').doc(currentUserId).get();
        const freshData = freshUser.data();
        document.getElementById('balanceValue').textContent =
          formatFull(freshData.balance);
        document.getElementById('statTotalEarnings').textContent =
          formatShort(freshData.totalEarnings);
      }

      const card = buildInvestmentCard(inv, invId);
      stack.appendChild(card);
    }

    /* â”€â”€ 10. Update last login timestamp in Firestore â”€â”€ */
    await db.collection('users').doc(currentUserId).update({
      lastLogin: firebase.firestore.FieldValue.serverTimestamp()
    });

  } catch (err) {
    console.error('Dashboard load error:', err);
    Swal.fire({
      icon: 'error',
      title: 'Could Not Load Dashboard',
      text: 'Please check your internet connection and try again.',
      confirmButtonColor: '#0052FF',
      confirmButtonText: 'Retry'
    }).then(() => window.location.reload());
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CREDIT DAILY ROI â€” FIRESTORE TRANSACTION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function creditROI(invId, dailyROI, invData) {
  if (!dailyROI || dailyROI <= 0) return;

  try {
    await db.runTransaction(async (tx) => {
      const invRef  = db.collection('investments').doc(invId);
      const userRef = db.collection('users').doc(currentUserId);

      const [freshInv, freshUser] = await Promise.all([
        tx.get(invRef),
        tx.get(userRef)
      ]);

      if (!freshInv.exists || !freshUser.exists) return;

      const iData = freshInv.data();
      const uData = freshUser.data();

      /* Check if plan duration has completed â€” deactivate if so */
      const activation   = iData.activationTime
        ? iData.activationTime.toDate()
        : new Date();
      const durationDays = iData.durationDays || 30;
      const daysPassed   = Math.floor(
        (Date.now() - activation.getTime()) / 86400000
      );

      if (daysPassed >= durationDays) {
        /* Plan complete â€” deactivate, return principal + any remaining ROI */
        tx.update(invRef, { active: false, completedAt: firebase.firestore.FieldValue.serverTimestamp() });
        /* Credit the final day ROI */
        tx.update(userRef, {
          balance:       (uData.balance || 0) + dailyROI,
          totalEarnings: (uData.totalEarnings || 0) + dailyROI
        });
      } else {
        /* Normal daily credit */
        tx.update(userRef, {
          balance:       (uData.balance || 0) + dailyROI,
          totalEarnings: (uData.totalEarnings || 0) + dailyROI
        });
        tx.update(invRef, {
          lastROI: firebase.firestore.FieldValue.serverTimestamp()
        });
      }

      /* Write ROI log record for admin tracking */
      const logRef = db.collection('roi_logs').doc();
      tx.set(logRef, {
        userId:      currentUserId,
        invId,
        planName:    iData.planName || '',
        amount:      dailyROI,
        daysPassed,
        creditedAt:  firebase.firestore.FieldValue.serverTimestamp()
      });
    });
  } catch (e) {
    console.error('ROI transaction error:', e.message);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILD INVESTMENT CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildInvestmentCard(inv, invId) {
  const card = document.createElement('div');
  card.className = 'inv-card';

  const activation   = inv.activationTime
    ? inv.activationTime.toDate()
    : new Date();
  const durationDays = inv.durationDays || 30;
  const endDate      = new Date(
    activation.getTime() + durationDays * 86400000
  );
  const daysPassed   = Math.max(
    0,
    Math.floor((Date.now() - activation.getTime()) / 86400000)
  );
  const daysLeft     = Math.max(0, durationDays - daysPassed);
  const progress     = Math.min(
    ((daysPassed / durationDays) * 100).toFixed(1),
    100
  );
  const totalEarned  = (inv.dailyROI || 0) * daysPassed;

  /* Next ROI countdown */
  const lastROIDate  = inv.lastROI
    ? inv.lastROI.toDate()
    : activation;
  const nextROIDate  = new Date(lastROIDate.getTime() + 86400000);

  const planName   = inv.planName || 'Investment Plan';
  const badgeCls   = getPlanBadgeClass(planName);

  const startStr = activation.toLocaleDateString('en-NG', {
    day: '2-digit', month: 'short', year: 'numeric'
  });
  const endStr = endDate.toLocaleDateString('en-NG', {
    day: '2-digit', month: 'short', year: 'numeric'
  });

  card.innerHTML = `
    <div class="inv-top">
      <div>
        <div class="inv-plan-name">${planName}</div>
        <span class="inv-badge ${badgeCls}">${planName}</span>
      </div>
      <div class="inv-active-tag">
        <div class="pulse-dot"></div>
        Active
      </div>
    </div>

    <div class="inv-details">
      <div class="inv-det">
        <div class="d-label">Amount Invested</div>
        <div class="d-val">â‚¦${Number(inv.amount || 0).toLocaleString('en-NG')}</div>
      </div>
      <div class="inv-det">
        <div class="d-label">Daily ROI</div>
        <div class="d-val green">â‚¦${Number(inv.dailyROI || 0).toLocaleString('en-NG')}</div>
      </div>
      <div class="inv-det">
        <div class="d-label">Start Date</div>
        <div class="d-val">${startStr}</div>
      </div>
      <div class="inv-det">
        <div class="d-label">End Date</div>
        <div class="d-val">${endStr}</div>
      </div>
      <div class="inv-det">
        <div class="d-label">Days Passed</div>
        <div class="d-val">${daysPassed} / ${durationDays}</div>
      </div>
      <div class="inv-det">
        <div class="d-label">Days Remaining</div>
        <div class="d-val">${daysLeft} day${daysLeft !== 1 ? 's' : ''}</div>
      </div>
    </div>

    <div class="prog-wrap">
      <div class="prog-meta">
        <span>Plan Progress</span>
        <span>${progress}%</span>
      </div>
      <div class="prog-track">
        <div class="prog-fill" style="width: ${progress}%;"></div>
      </div>
    </div>

    <div class="countdown-box">
      <div class="cd-label">
        <i class="fas fa-clock" style="color:var(--primary); font-size:13px;"></i>
        Next ROI Credit In
      </div>
      <div class="cd-timer" id="timer_${invId}">--:--:--</div>
    </div>

    <div class="inv-earned-row">
      ğŸ’µ Total Earned So Far: â‚¦${totalEarned.toLocaleString('en-NG', {
        minimumFractionDigits: 2, maximumFractionDigits: 2
      })}
    </div>
  `;

  /* â”€â”€ Start live countdown for this card â”€â”€ */
  function runCountdown() {
    const el = document.getElementById(`timer_${invId}`);
    if (!el) return;

    const diff = nextROIDate.getTime() - Date.now();

    if (diff <= 0) {
      el.textContent = 'âœ“ Ready to credit!';
      el.classList.add('ready');
    } else {
      const h = Math.floor(diff / 3600000);
      const m = Math.floor((diff % 3600000) / 60000);
      const s = Math.floor((diff % 60000) / 1000);
      el.textContent =
        String(h).padStart(2, '0') + ':' +
        String(m).padStart(2, '0') + ':' +
        String(s).padStart(2, '0');
    }
  }

  runCountdown();
  const timerId = setInterval(runCountdown, 1000);
  countdownTimers.push(timerId);

  return card;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COPY REFERRAL LINK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function copyReferralLink() {
  const origin  = window.location.origin;
  const link    = `${origin}/signup.html?ref=${userReferralCode}`;
  const btn     = document.getElementById('refCopyBtn');

  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(link).then(() => {
      btn.textContent = 'âœ“ Copied!';
      setTimeout(() => { btn.textContent = 'Copy'; }, 2500);
    }).catch(() => fallbackCopy(link, btn));
  } else {
    fallbackCopy(link, btn);
  }
}

function fallbackCopy(text, btn) {
  const el = document.createElement('textarea');
  el.value = text;
  el.style.cssText = 'position:fixed;opacity:0;';
  document.body.appendChild(el);
  el.select();
  try {
    document.execCommand('copy');
    btn.textContent = 'âœ“ Copied!';
    setTimeout(() => { btn.textContent = 'Copy'; }, 2500);
  } catch (e) {
    btn.textContent = 'Failed';
    setTimeout(() => { btn.textContent = 'Copy'; }, 2500);
  }
  document.body.removeChild(el);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGOUT WITH CONFIRMATION
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function confirmLogout() {
  Swal.fire({
    title: 'Sign Out?',
    text: 'Are you sure you want to sign out of your account?',
    icon: 'question',
    showCancelButton: true,
    confirmButtonColor: '#FF4D6D',
    cancelButtonColor: '#0052FF',
    confirmButtonText: 'Yes, Sign Out',
    cancelButtonText: 'Stay Logged In',
    reverseButtons: true
  }).then((result) => {
    if (result.isConfirmed) {
      if (dashboardRefresh) clearInterval(dashboardRefresh);
      countdownTimers.forEach(id => clearInterval(id));
      auth.signOut().then(() => {
        window.location.href = 'login.html';
      }).catch((err) => {
        Swal.fire('Error', 'Could not sign out: ' + err.message, 'error');
      });
    }
  });
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLAIM PENDING REFERRAL CREDITS
   Reads unclaimed referral_credits where uplineUid == me
   and applies them to my own balance (rules allow self-update).
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function claimPendingReferralCredits(userUid) {
  if (!userUid) return;
  try {
    const snap = await db.collection('referral_credits')
      .where('uplineUid', '==', userUid)
      .where('claimed', '==', false)
      .get();

    if (snap.empty) return;

    console.log(`[Credits] ${snap.size} unclaimed referral credit(s) found`);

    let total = 0;
    const batch = db.batch();

    snap.docs.forEach(doc => {
      const bonus = Number(doc.data().bonusAmount || 0);
      if (bonus <= 0) return;
      batch.update(db.collection('users').doc(userUid), {
        balance:          firebase.firestore.FieldValue.increment(bonus),
        totalEarnings:    firebase.firestore.FieldValue.increment(bonus),
        totalRefEarnings: firebase.firestore.FieldValue.increment(bonus)
      });
      batch.update(doc.ref, {
        claimed:   true,
        claimedAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      total += bonus;
    });

    await batch.commit();
    console.log(`[Credits] âœ… Claimed â‚¦${total} in referral credits`);
  } catch(e) {
    console.warn('[Credits] Claim error:', e.code, e.message);
  }
}
</script>
</body>
</html>
