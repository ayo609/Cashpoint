<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cashpoint | Login</title>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Sora:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary:       #0052FF;
      --primary-light: #3b7dff;
      --primary-dark:  #0039b3;
      --accent:        #00D4A0;
      --danger:        #FF4D6D;
      --success:       #00C48C;
      --bg:            #F0F4FF;
      --card:          #ffffff;
      --text:          #0D1B3E;
      --muted:         #6B7A99;
      --border:        #D8E0F0;
      --shadow:        0 20px 60px rgba(0, 82, 255, 0.12);
      --radius:        14px;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      background: var(--bg);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px 16px;
      position: relative;
      overflow-x: hidden;
    }

    /* ‚îÄ‚îÄ Background orbs ‚îÄ‚îÄ */
    body::before, body::after {
      content: '';
      position: fixed;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.35;
      pointer-events: none;
      z-index: 0;
    }
    body::before {
      width: 500px; height: 500px;
      background: radial-gradient(circle, #0052FF 0%, transparent 70%);
      top: -150px; left: -150px;
    }
    body::after {
      width: 400px; height: 400px;
      background: radial-gradient(circle, #00D4A0 0%, transparent 70%);
      bottom: -100px; right: -100px;
    }

    /* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
    .card {
      background: var(--card);
      max-width: 460px;
      width: 100%;
      border-radius: 24px;
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
      z-index: 1;
      animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) both;
    }

    @keyframes slideUp {
      from { opacity: 0; transform: translateY(32px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    .card-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      padding: 36px 40px 32px;
      position: relative;
      overflow: hidden;
    }
    .card-header::before {
      content: '';
      position: absolute;
      width: 200px; height: 200px;
      background: rgba(255,255,255,0.06);
      border-radius: 50%;
      top: -60px; right: -40px;
    }
    .card-header::after {
      content: '';
      position: absolute;
      width: 120px; height: 120px;
      background: rgba(255,255,255,0.04);
      border-radius: 50%;
      bottom: -30px; left: 20px;
    }
    .logo-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 6px;
    }
    .logo-icon {
      width: 42px; height: 42px;
      background: rgba(255,255,255,0.18);
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 22px;
    }
    .logo-text {
      font-family: 'Sora', sans-serif;
      font-size: 26px;
      font-weight: 600;
      color: #fff;
      letter-spacing: -0.5px;
    }
    .header-sub {
      color: rgba(255,255,255,0.72);
      font-size: 14px;
      font-weight: 500;
      margin-top: 2px;
    }

    /* ‚îÄ‚îÄ Card Body ‚îÄ‚îÄ */
    .card-body {
      padding: 32px 40px 36px;
    }

    /* ‚îÄ‚îÄ Welcome back chip ‚îÄ‚îÄ */
    .welcome-chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #F0F4FF;
      border: 1.5px solid var(--border);
      border-radius: 99px;
      padding: 7px 14px;
      font-size: 13px;
      font-weight: 600;
      color: var(--primary);
      margin-bottom: 24px;
    }
    .welcome-chip .dot {
      width: 7px; height: 7px;
      background: var(--accent);
      border-radius: 50%;
      animation: pulse 1.8s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50%       { transform: scale(1.4); opacity: 0.6; }
    }

    /* ‚îÄ‚îÄ Section label ‚îÄ‚îÄ */
    .section-label {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 14px;
    }

    /* ‚îÄ‚îÄ Fields ‚îÄ‚îÄ */
    .field {
      margin-bottom: 16px;
    }
    .field-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 6px;
    }
    .field label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
    }
    .forgot-link {
      font-size: 12.5px;
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
      transition: color 0.2s;
    }
    .forgot-link:hover { color: var(--primary-dark); text-decoration: underline; }

    .input-wrap {
      position: relative;
    }
    .input-wrap .field-icon {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 17px;
      pointer-events: none;
      opacity: 0.5;
    }
    .input-wrap input {
      width: 100%;
      padding: 13px 16px 13px 42px;
      border: 1.5px solid var(--border);
      border-radius: var(--radius);
      font-size: 15px;
      font-family: inherit;
      color: var(--text);
      background: #FAFBFF;
      transition: border-color 0.2s, box-shadow 0.2s, background 0.2s;
      outline: none;
    }
    .input-wrap input:focus {
      border-color: var(--primary);
      background: #fff;
      box-shadow: 0 0 0 4px rgba(0, 82, 255, 0.08);
    }
    .input-wrap input.error {
      border-color: var(--danger);
      background: #FFF5F7;
    }
    .input-wrap input::placeholder { color: #B0BAD4; }

    .has-toggle input { padding-right: 44px; }

    .toggle-password {
      position: absolute;
      right: 14px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 16px;
      opacity: 0.5;
      transition: opacity 0.2s;
      user-select: none;
    }
    .toggle-password:hover { opacity: 0.9; }

    /* ‚îÄ‚îÄ Remember me ‚îÄ‚îÄ */
    .remember-row {
      display: flex;
      align-items: center;
      gap: 9px;
      margin-bottom: 8px;
    }
    .remember-row input[type="checkbox"] {
      width: 17px; height: 17px;
      accent-color: var(--primary);
      cursor: pointer;
      flex-shrink: 0;
    }
    .remember-row label {
      font-size: 13.5px;
      color: var(--muted);
      font-weight: 500;
      cursor: pointer;
    }

    /* ‚îÄ‚îÄ Submit button ‚îÄ‚îÄ */
    .btn-submit {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      color: #fff;
      border: none;
      border-radius: var(--radius);
      font-size: 16px;
      font-weight: 700;
      font-family: inherit;
      cursor: pointer;
      letter-spacing: 0.01em;
      transition: transform 0.15s, box-shadow 0.15s, opacity 0.2s;
      box-shadow: 0 6px 24px rgba(0, 82, 255, 0.3);
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-submit:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 32px rgba(0, 82, 255, 0.38);
    }
    .btn-submit:active:not(:disabled) { transform: translateY(0); }
    .btn-submit:disabled {
      opacity: 0.65;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .spinner {
      display: inline-block;
      width: 18px; height: 18px;
      border: 2.5px solid rgba(255,255,255,0.4);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin 0.7s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ Divider ‚îÄ‚îÄ */
    .divider {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 22px 0;
      color: var(--muted);
      font-size: 12px;
      font-weight: 600;
    }
    .divider::before, .divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* ‚îÄ‚îÄ Signup link ‚îÄ‚îÄ */
    .signup-link {
      text-align: center;
      font-size: 14px;
      color: var(--muted);
    }
    .signup-link a {
      color: var(--primary);
      font-weight: 700;
      text-decoration: none;
      transition: color 0.2s;
    }
    .signup-link a:hover { color: var(--primary-dark); text-decoration: underline; }

    /* ‚îÄ‚îÄ Security badge ‚îÄ‚îÄ */
    .security-note {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      margin-top: 18px;
      font-size: 12px;
      color: var(--muted);
      font-weight: 500;
    }
    .security-note span { font-size: 14px; }

    /* ‚îÄ‚îÄ Shake ‚îÄ‚îÄ */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%       { transform: translateX(-8px); }
      40%       { transform: translateX(8px); }
      60%       { transform: translateX(-5px); }
      80%       { transform: translateX(5px); }
    }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media (max-width: 520px) {
      .card-header { padding: 28px 24px; }
      .card-body   { padding: 24px 24px 30px; }
    }
  </style>
</head>

<body>

<div class="card">

  <!-- Header -->
  <div class="card-header">
    <div class="logo-row">
      <div class="logo-icon">üí∞</div>
      <span class="logo-text">Cashpoint</span>
    </div>
    <p class="header-sub">Sign in to manage your investments</p>
  </div>

  <!-- Body -->
  <div class="card-body">

    <div class="welcome-chip">
      <div class="dot"></div>
      Welcome back
    </div>

    <p class="section-label">Your Credentials</p>

    <!-- Email -->
    <div class="field">
      <div class="field-top">
        <label for="loginEmail">Email Address</label>
      </div>
      <div class="input-wrap">
        <span class="field-icon">‚úâÔ∏è</span>
        <input type="email" id="loginEmail" placeholder="you@example.com"
               autocomplete="email" />
      </div>
    </div>

    <!-- Password -->
    <div class="field">
      <div class="field-top">
        <label for="loginPassword">Password</label>
        <a href="forgot-password.html" class="forgot-link">Forgot password?</a>
      </div>
      <div class="input-wrap has-toggle">
        <span class="field-icon">üîí</span>
        <input type="password" id="loginPassword" placeholder="Enter your password"
               autocomplete="current-password" />
        <span class="toggle-password" onclick="togglePass('loginPassword', this)">üëÅÔ∏è</span>
      </div>
    </div>

    <!-- Remember me -->
    <div class="remember-row">
      <input type="checkbox" id="rememberMe" />
      <label for="rememberMe">Keep me signed in</label>
    </div>

    <!-- Login button -->
    <button class="btn-submit" type="button" id="loginBtn">
      Sign In to Cashpoint
    </button>

    <div class="divider">or</div>

    <div class="signup-link">
      Don't have an account? <a href="signup.html">Create one free ‚Üí</a>
    </div>

    <div class="security-note">
      <span>üîê</span> Secured with 256-bit encryption
    </div>

  </div>
</div>

<script>
  /* ‚îÄ‚îÄ‚îÄ Firebase Init ‚îÄ‚îÄ‚îÄ */
  const firebaseConfig = {
    apiKey: "AIzaSyCFwefJ8rxZUDLbDsRHnHdA-28zPs49rlo",
    authDomain: "cashpoint-ac4f4.firebaseapp.com",
    projectId: "cashpoint-ac4f4",
    storageBucket: "cashpoint-ac4f4.firebasestorage.app",
    messagingSenderId: "16133206416",
    appId: "1:16133206416:web:a093f4e153ad2c9bcc8315"
  };

  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db   = firebase.firestore();

  /* ‚îÄ‚îÄ‚îÄ Restore saved email ‚îÄ‚îÄ‚îÄ */
  window.addEventListener('DOMContentLoaded', () => {
    const saved = localStorage.getItem('cp_saved_email');
    if (saved) {
      document.getElementById('loginEmail').value = saved;
      document.getElementById('rememberMe').checked = true;
    }
  });

  /* ‚îÄ‚îÄ‚îÄ Password Toggle ‚îÄ‚îÄ‚îÄ */
  function togglePass(id, icon) {
    const input = document.getElementById(id);
    input.type  = input.type === 'password' ? 'text' : 'password';
    icon.textContent = input.type === 'password' ? 'üëÅÔ∏è' : 'üôà';
  }

  /* ‚îÄ‚îÄ‚îÄ Allow Enter key to submit ‚îÄ‚îÄ‚îÄ */
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') login();
  });

  /* ‚îÄ‚îÄ‚îÄ Login ‚îÄ‚îÄ‚îÄ */
  document.getElementById('loginBtn').addEventListener('click', login);

  async function login() {
    const email    = document.getElementById('loginEmail').value.trim();
    const password = document.getElementById('loginPassword').value;
    const remember = document.getElementById('rememberMe').checked;
    const btn      = document.getElementById('loginBtn');

    /* Validation */
    if (!email || !password) {
      shakeBtn();
      Swal.fire({
        icon: 'warning',
        title: 'Missing Fields',
        text: 'Please enter your email and password to continue.'
      });
      return;
    }

    /* Email format check */
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
      document.getElementById('loginEmail').classList.add('error');
      Swal.fire({ icon: 'error', title: 'Invalid Email', text: 'Please enter a valid email address.' });
      return;
    }
    document.getElementById('loginEmail').classList.remove('error');

    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span> Signing in...';

    try {
      /* ‚îÄ‚îÄ Set persistence based on "remember me" ‚îÄ‚îÄ */
      const persistence = remember
        ? firebase.auth.Auth.Persistence.LOCAL
        : firebase.auth.Auth.Persistence.SESSION;
      await auth.setPersistence(persistence);

      /* ‚îÄ‚îÄ Sign in ‚îÄ‚îÄ */
      const cred = await auth.signInWithEmailAndPassword(email, password);

      /* ‚îÄ‚îÄ Fetch Firestore user doc ‚îÄ‚îÄ */
      const userDoc = await db.collection('users').doc(cred.user.uid).get();
      if (!userDoc.exists) {
        await auth.signOut();
        throw { message: 'Account data not found. Please contact support or sign up again.' };
      }

      const userData = userDoc.data();

      /* ‚îÄ‚îÄ Save email if remember me checked ‚îÄ‚îÄ */
      if (remember) {
        localStorage.setItem('cp_saved_email', email);
      } else {
        localStorage.removeItem('cp_saved_email');
      }

      /* ‚îÄ‚îÄ Update last login timestamp ‚îÄ‚îÄ */
      await db.collection('users').doc(cred.user.uid).update({
        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
      });

      /* ‚îÄ‚îÄ Success ‚îÄ‚îÄ */
      Swal.fire({
        icon: 'success',
        title: `Welcome back, ${userData.fullName?.split(' ')[0] || 'there'} üëã`,
        text: 'Login successful. Taking you to your dashboard...',
        timer: 2000,
        timerProgressBar: true,
        showConfirmButton: false
      });

      /* ‚îÄ‚îÄ Redirect: admin goes to admin panel, user goes to home ‚îÄ‚îÄ */
      setTimeout(() => {
        if (userData.isAdmin) {
          window.location.href = 'admin.html';
        } else {
          window.location.href = 'home.html';
        }
      }, 2000);

    } catch (error) {
      btn.disabled = false;
      btn.textContent = 'Sign In to Cashpoint';

      let msg = 'Login failed. Please try again.';
      if (error.code === 'auth/user-not-found')        msg = 'No account found with this email. Please sign up.';
      else if (error.code === 'auth/wrong-password')   msg = 'Incorrect password. Please try again.';
      else if (error.code === 'auth/invalid-email')    msg = 'Please enter a valid email address.';
      else if (error.code === 'auth/invalid-credential') msg = 'Invalid email or password. Please check and try again.';
      else if (error.code === 'auth/too-many-requests') msg = 'Too many failed attempts. Please wait a moment and try again.';
      else if (error.code === 'auth/network-request-failed') msg = 'Network error. Check your connection and try again.';
      else if (error.message) msg = error.message;

      Swal.fire({ icon: 'error', title: 'Login Failed', text: msg });
    }
  }

  /* ‚îÄ‚îÄ‚îÄ Shake animation helper ‚îÄ‚îÄ‚îÄ */
  function shakeBtn() {
    const btn = document.getElementById('loginBtn');
    btn.style.animation = 'none';
    void btn.offsetWidth;
    btn.style.animation = 'shake 0.4s ease';
  }
</script>

</body>
</html>