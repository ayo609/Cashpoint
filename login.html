<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Cashpoint | Login</title>

<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Sora:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root {
    --primary:      #0052FF;
    --primary-dark: #0039b3;
    --accent:       #00D4A0;
    --success:      #00C48C;
    --danger:       #FF4D6D;
    --warning:      #FFB800;
    --bg:           #F0F4FF;
    --text:         #0D1B3E;
    --muted:        #6B7A99;
    --border:       #D8E0F0;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  html { scroll-behavior:smooth; }
  body {
    font-family:'Plus Jakarta Sans',sans-serif;
    background:var(--bg); color:var(--text);
    min-height:100vh; overflow-x:hidden;
  }

  .top-hero {
    background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 55%,#001c6b 100%);
    padding:48px 24px 110px; text-align:center; position:relative; overflow:hidden;
  }
  .top-hero::before {
    content:''; position:absolute; width:320px; height:320px; border-radius:50%;
    background:rgba(255,255,255,0.05); top:-80px; right:-60px;
  }
  .top-hero::after {
    content:''; position:absolute; width:180px; height:180px; border-radius:50%;
    background:rgba(0,212,160,0.1); bottom:-50px; left:-30px;
  }
  .logo-row {
    display:flex; align-items:center; justify-content:center; gap:10px;
    margin-bottom:24px; position:relative; z-index:1;
  }
  .logo-box { 
    width:44px;height:44px;background:rgba(255,255,255,0.18);border-radius:13px;
    display:flex;align-items:center;justify-content:center;font-size:22px; 
  }
  .logo-name { font-family:'Sora',sans-serif;font-size:22px;font-weight:700;color:white; }
  .hero-h { 
    font-family:'Sora',sans-serif;font-size:clamp(22px,6vw,32px);font-weight:700;
    color:white;margin-bottom:8px;position:relative;z-index:1; 
  }
  .hero-sub { 
    font-size:13.5px;color:rgba(255,255,255,0.7);font-weight:500;
    position:relative;z-index:1; 
  }

  .card-outer { 
    padding:0 16px; margin-top:-72px; position:relative; z-index:10; 
    padding-bottom:40px; 
  }
  .form-card {
    background:white; border-radius:24px;
    box-shadow:0 16px 50px rgba(0,82,255,0.15);
    overflow:hidden;
    animation:riseUp .5s cubic-bezier(.16,1,.3,1) both;
  }
  @keyframes riseUp { from{opacity:0;transform:translateY(24px)} to{opacity:1;transform:translateY(0)} }

  .form-body { 
    padding:28px 22px; display:flex; flex-direction:column; gap:18px; 
  }

  .fg { display:flex; flex-direction:column; gap:7px; }
  .fg-label {
    font-size:12px;font-weight:700;color:var(--muted);
    text-transform:uppercase;letter-spacing:.06em;
    display:flex;align-items:center;gap:6px;
  }
  .fg-label i { font-size:12px;color:var(--primary); }
  .fg-row {
    display:flex;align-items:center;
    border:2px solid var(--border);border-radius:13px;overflow:hidden;
    transition:border-color .2s;
  }
  .fg-row:focus-within { border-color:var(--primary); }
  .fg-row.error { border-color:var(--danger); }
  .fg-prefix {
    padding:0 14px;background:var(--bg);font-size:15px;
    color:var(--muted);border-right:2px solid var(--border);
    height:100%;display:flex;align-items:center;flex-shrink:0;
  }
  .fg-input {
    flex:1;padding:13px 14px;font-size:15px;font-weight:600;
    font-family:inherit;border:none;outline:none;
    color:var(--text);min-width:0;
  }
  .fg-input::placeholder { color:var(--border);font-weight:400; }
  .fg-suffix {
    padding:0 14px;cursor:pointer;color:var(--muted);font-size:16px;
    background:none;border:none;flex-shrink:0;
  }

  .submit-btn {
    width:100%;padding:15px;border:none;border-radius:14px;
    font-size:16px;font-weight:700;font-family:inherit;cursor:pointer;
    color:white;background:linear-gradient(135deg,var(--primary),var(--primary-dark));
    box-shadow:0 7px 24px rgba(0,82,255,0.3);
    display:flex;align-items:center;justify-content:center;gap:9px;
    transition:transform .15s,box-shadow .15s;
  }
  .submit-btn:hover { 
    transform:translateY(-2px);box-shadow:0 12px 32px rgba(0,82,255,0.38); 
  }
  .submit-btn:disabled { 
    opacity:.6;cursor:not-allowed;transform:none!important; 
  }

  .link-row {
    text-align:center;font-size:14px;color:var(--muted);font-weight:600;
    padding:0 22px 28px;
  }
  .link-row a { color:var(--primary);font-weight:700;text-decoration:none; }

  .page-bottom { height:30px; }
</style>
</head>
<body>

<div class="top-hero">
  <div class="logo-row">
    <div class="logo-box">ðŸ’°</div>
    <div class="logo-name">Cashpoint</div>
  </div>
  <div class="hero-h">Welcome Back ðŸ‘‹</div>
  <div class="hero-sub">Login to continue earning daily returns</div>
</div>

<div class="card-outer">
  <div class="form-card">
    <div class="form-body">
      
      <div class="fg">
        <label class="fg-label">
          <i class="fas fa-envelope"></i>
          Email Address
        </label>
        <div class="fg-row" id="emailRow">
          <div class="fg-prefix">@</div>
          <input 
            type="email" 
            id="emailInput" 
            class="fg-input" 
            placeholder="your@email.com"
            autocomplete="email"
          />
        </div>
      </div>

      <div class="fg">
        <label class="fg-label">
          <i class="fas fa-lock"></i>
          Password
        </label>
        <div class="fg-row" id="passwordRow">
          <div class="fg-prefix">ðŸ”’</div>
          <input 
            type="password" 
            id="passwordInput" 
            class="fg-input" 
            placeholder="Enter your password"
            autocomplete="current-password"
          />
          <button 
            type="button" 
            class="fg-suffix" 
            onclick="togglePassword()"
            id="toggleBtn"
          >
            <i class="fas fa-eye" id="toggleIcon"></i>
          </button>
        </div>
      </div>

      <button class="submit-btn" onclick="handleLogin()" id="loginBtn">
        <i class="fas fa-sign-in-alt"></i>
        Login to Dashboard
      </button>

    </div>

    <div class="link-row">
      Don't have an account? <a href="signup.html">Sign up here</a>
    </div>

  </div>
</div>

<div class="page-bottom"></div>

<script>
const firebaseConfig = {
  apiKey:            "AIzaSyCFwefJ8rxZUDLbDsRHnHdA-28zPs49rlo",
  authDomain:        "cashpoint-ac4f4.firebaseapp.com",
  projectId:         "cashpoint-ac4f4",
  storageBucket:     "cashpoint-ac4f4.firebasestorage.app",
  messagingSenderId: "16133206416",
  appId:             "1:16133206416:web:a093f4e153ad2c9bcc8315"
};

if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.firestore();

function togglePassword() {
  const input = document.getElementById('passwordInput');
  const icon  = document.getElementById('toggleIcon');
  
  if (input.type === 'password') {
    input.type = 'text';
    icon.className = 'fas fa-eye-slash';
  } else {
    input.type = 'password';
    icon.className = 'fas fa-eye';
  }
}

async function handleLogin() {
  const email    = document.getElementById('emailInput').value.trim();
  const password = document.getElementById('passwordInput').value;
  const btn      = document.getElementById('loginBtn');

  if (!email || !password) {
    Swal.fire({
      icon: 'warning',
      title: 'Enter email and password',
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 3000,
      timerProgressBar: true
    });
    return;
  }

  if (!email.includes('@')) {
    Swal.fire({
      icon: 'warning',
      title: 'Invalid email address',
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 3000,
      timerProgressBar: true
    });
    return;
  }

  btn.disabled = true;

  // Show loading toast at top
  Swal.fire({
    icon: 'info',
    title: 'Logging in...',
    toast: true,
    position: 'top-end',
    showConfirmButton: false,
    timer: 0
  });

  try {
    const userCredential = await auth.signInWithEmailAndPassword(email, password);
    const user = userCredential.user;

    try {
      await db.collection('users').doc(user.uid).update({
        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
      });
    } catch (updateErr) {
      console.warn('Could not update last login:', updateErr.message);
    }

    let userName = 'User';
    try {
      const userDoc = await db.collection('users').doc(user.uid).get();
      if (userDoc.exists) {
        const data = userDoc.data();
        userName = data.fullName || data.username || 'User';
      }
    } catch (docErr) {
      console.warn('Could not fetch user data:', docErr.message);
    }

    // Show success toast
    Swal.fire({
      icon: 'success',
      title: `Welcome back, ${userName.split(' ')[0]}!`,
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 2000,
      timerProgressBar: true
    });

    setTimeout(() => {
      window.location.href = 'home.html';
    }, 500);

  } catch (err) {
    console.error('Login error:', err.code, err.message);

    let msg = 'Login failed. Please try again.';
    
    if (err.code === 'auth/user-not-found') {
      msg = 'No account found with this email. Please sign up first.';
    } else if (err.code === 'auth/wrong-password') {
      msg = 'Incorrect password. Please try again.';
    } else if (err.code === 'auth/invalid-email') {
      msg = 'Invalid email address format.';
    } else if (err.code === 'auth/user-disabled') {
      msg = 'This account has been disabled. Contact support.';
    } else if (err.code === 'auth/too-many-requests') {
      msg = 'Too many failed attempts. Please try again later.';
    } else if (err.code === 'auth/network-request-failed') {
      msg = 'Network error. Please check your internet connection.';
    } else if (err.code === 'auth/invalid-credential') {
      msg = 'Invalid email or password. Please check and try again.';
    }

    Swal.fire({
      icon: 'error',
      title: msg,
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 4000,
      timerProgressBar: true
    });

    btn.disabled = false;
  }
}

document.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') {
    handleLogin();
  }
});

auth.onAuthStateChanged(user => {
  if (user) {
    window.location.href = 'home.html';
  }
});
</script>

</body>
</html>
